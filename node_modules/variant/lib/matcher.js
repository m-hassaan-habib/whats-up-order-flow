"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.matcher = void 0;
/**
 * *Extremely* beta, do not use unless you've spoken to me.
 * @param target
 * @param handler
 * @param _typeKey
 */
function matcher(target, handler = {}, _typeKey = 'type') {
    return {
        target,
        handler,
        key: _typeKey !== null && _typeKey !== void 0 ? _typeKey : 'type',
        when: function (hp, hfunc) {
            // The case where an array is passed in.
            if (Array.isArray(hp)) {
                const keys = hp.map(keyOrVC => {
                    if (typeof keyOrVC === 'string') {
                        return keyOrVC;
                    }
                    else {
                        return keyOrVC.type;
                    }
                });
                if (hfunc) {
                    const obj = keys.reduce((acc, key) => {
                        return Object.assign(Object.assign({}, acc), { [key]: hfunc });
                    }, {});
                    return Object.assign(Object.assign({}, this), { handler: Object.assign(Object.assign({}, this.handler), obj) });
                }
                else {
                    // ERROR
                    return this;
                }
            }
            else {
                return Object.assign(Object.assign({}, this), { handler: Object.assign(Object.assign({}, this.handler), hp) });
            }
        },
        execute: function () {
            const result = this.handler[this.target[this.key]];
            return result(this.target);
        },
        complete: function () {
            return this.execute();
        },
        else: function (func) {
            var _a;
            if (this.target[this.key] in ((_a = this.handler) !== null && _a !== void 0 ? _a : {})) {
                return this.execute();
            }
            else {
                return func(this.target);
            }
        }
    };
}
exports.matcher = matcher;
//# sourceMappingURL=matcher.js.map